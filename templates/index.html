<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse des Tokens Solana</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    
    


    <!-- Filtres -->
    <div class="filters-panel">
        <div class="suspicious-thresholds-container">
            <button id="toggleThresholds" class="toggle-button">
                Seuils de détection ▼
            </button>
            <div class="suspicious-thresholds" id="thresholdsPanel" style="display: none;">
                <div class="filter-options">
                    <label>
                        Variation prix suspect (%)
                        <div class="threshold-inputs">
                            <input type="number" id="priceChangeMin" placeholder="Min" value="-50">
                            <input type="number" id="priceChangeMax" placeholder="Max" value="100">
                        </div>
                    </label>
                    <label>
                        Ratio Vol/Liq suspect >
                        <input type="number" id="volLiqThreshold" value="5" step="0.1">
                    </label>
                    <label>
                        Ratio Vol/MC suspect >
                        <input type="number" id="volMcThreshold" value="3" step="0.1">
                    </label>
                    <label>
                        Ratio Liq/MC suspect <
                        <input type="number" id="liqMcThreshold" value="0.05" step="0.01">
                    </label>
                </div>
            </div>
        </div>
        <h3>Filtres</h3>
        <div class="filter-options">
            <label>
                <input type="checkbox" id="filter24h" checked>
                Tokens > 24h
            </label>
            <label>
                <input type="checkbox" id="filterSuspicious">
                Masquer les tokens suspects
            </label>
            <label>
                <input type="number" id="minLiquidity" placeholder="Liquidité min ($)">
                Liquidité minimum
            </label>
            <label>
                <input type="number" id="minVolume" placeholder="Volume min ($)">
                Volume minimum
            </label>
            <!-- Nouveaux filtres Market Cap -->
            <label>
                <input type="number" id="minMc" placeholder="MCap min ($)">
                Market Cap minimum
            </label>
            <label>
                <input type="number" id="maxMc" placeholder="MCap max ($)">
                Market Cap maximum
            </label>
        </div>
        <button id="applyFilters">Appliquer les filtres</button>
    </div>

    <div class="filter-stats">
        <span id="visibleCount">{{ tokens|length }} tokens affichés</span>
        <button id="resetFilters" class="reset-button">Réinitialiser les filtres</button>
    </div>
    <div class="score-weights-container">
        <button id="toggleWeights" class="toggle-button">
            Coefficients du Score ▼
        </button>
        <div class="score-weights" id="weightsPanel" style="display: none;">
            <div class="weight-options">
                <label>
                    Variation prix
                    <input type="number" id="priceChangeWeight" value="0.15" step="0.05" min="0" max="1">
                </label>
                <label>
                    Volume
                    <input type="number" id="volumeWeight" value="0.15" step="0.05" min="0" max="1">
                </label>
                <label>
                    Liquidité
                    <input type="number" id="liquidityWeight" value="0.15" step="0.05" min="0" max="1">
                </label>
                <label>
                    Ratio Vol/Liq
                    <input type="number" id="volLiqWeight" value="0.20" step="0.05" min="0" max="1">
                </label>
                <label>
                    Ratio Vol/MC
                    <input type="number" id="volMcWeight" value="0.20" step="0.05" min="0" max="1">
                </label>
                <label>
                    Ratio Liq/MC
                    <input type="number" id="liqMcWeight" value="0.15" step="0.05" min="0" max="1">
                </label>
            </div>
            <div class="weight-total">Total: <span id="weightTotal">1.00</span></div>
            <button id="applyWeights">Appliquer les coefficients</button>
        </div>
    </div>

    <!-- Contrôles de comparaison -->
    <div class="comparison-controls">
        <button id="compareButton" disabled>Comparer les tokens sélectionnés</button>
        <span id="selectedCount">(0 sélectionné)</span>
    </div>

    {% if tokens %}
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th><input type="checkbox" id="selectAll"></th>
                    <th><a href="#" data-column="symbol" onclick="sortTable('symbol'); return false;">Symbole</a></th>
                    <th><a href="#" data-column="name" onclick="sortTable('name'); return false;">Nom</a></th>
                    <th><a href="#" data-column="liquidity" onclick="sortTable('liquidity'); return false;">Liq. ($)</a></th>
                    <th><a href="#" data-column="v24hUSD" onclick="sortTable('v24hUSD'); return false;">Vol. 24h ($)</a></th>
                    <th><a href="#" data-column="mc" onclick="sortTable('mc'); return false;">MCap ($)</a></th>
                    <th><a href="#" data-column="v24hChangePercent" onclick="sortTable('v24hChangePercent'); return false;" class="tooltip">
                        Δ Prix (%)
                        <span class="tooltiptext">Variation du prix sur 24h</span>
                    </a></th>
                    <th><a href="#" data-column="volume_liquidity_ratio" onclick="sortTable('volume_liquidity_ratio'); return false;" class="tooltip">
                        Vol/Liq
                        <span class="tooltiptext">Volume 24h / Liquidité</span>
                    </a></th>
                    <th><a href="#" data-column="volume_mc_ratio" onclick="sortTable('volume_mc_ratio'); return false;" class="tooltip">
                        Vol/MC
                        <span class="tooltiptext">Volume 24h / Market Cap</span>
                    </a></th>
                    <th><a href="#" data-column="liquidity_mc_ratio" onclick="sortTable('liquidity_mc_ratio'); return false;" class="tooltip">
                        Liq/MC
                        <span class="tooltiptext">Liquidité / Market Cap</span>
                    </a></th>
                    <th><a href="#" data-column="performance" onclick="sortTable('performance'); return false;" class="tooltip">
                        Score
                        <span class="tooltiptext">Score combiné basé sur les ratios</span>
                    </a></th>
                    <th><a href="#" data-column="is_pump" onclick="sortTable('is_pump'); return false;" class="tooltip">
                        Pump
                        <span class="tooltiptext">Token avec adresse finissant par 'pump'</span>
                    </a></th>
                </tr>
            </thead>
            <tbody>
                {% for token in tokens %}
                <tr>
                    <td><input type="checkbox" class="token-select" data-address="{{ token.address }}"></td>
                    <td>{{ token.symbol }}</td>
                    <td>{{ token.name }}</td>
                    <td>{{ "{:,.0f}".format(token.liquidity).replace(',', ' ') }}</td>
                    <td>{{ "{:,.0f}".format(token.v24hUSD).replace(',', ' ') }}</td>
                    <td>{{ "{:,.0f}".format(token.mc).replace(',', ' ') }}</td>
                    <td class="{{ 'positive' if token.v24hChangePercent > 0 else 'negative' }} {{ 'suspicious' if token.v24hChangePercent > 100 or token.v24hChangePercent < -50 }}">
                        {{ "{:+.2f}%".format(token.v24hChangePercent) }}
                    </td>
                    <td class="{{ 'suspicious' if token.volume_liquidity_ratio > 5 }}">
                        {{ "{:.2f}".format(token.volume_liquidity_ratio) }}
                    </td>
                    <td class="{{ 'suspicious' if token.volume_mc_ratio > 3 }}">
                        {{ "{:.2f}".format(token.volume_mc_ratio) }}
                    </td>
                    <td class="{{ 'suspicious' if token.liquidity_mc_ratio < 0.05 }}">
                        {{ "{:.2f}".format(token.liquidity_mc_ratio) }}
                    </td>
                    <td class="{{ 'positive' if token.performance > 0 else 'negative' }}">
                        {{ "{:+.2f}".format(token.performance) }}
                    </td>
                    <td style="text-align: center;">{{ "✓" if token.is_pump else "" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <p>Aucune donnée de token disponible.</p>
    {% endif %}

    <!-- Modal de comparaison -->
    <div id="comparisonModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Comparaison des tokens</h2>
            <div id="comparisonTable"></div>
        </div>
    </div>

    <!-- Script -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>